{"id":"npmx-8cd","title":"RED: npm install command tests","description":"Write failing tests for npm install command.\n\n## Test Cases\n```typescript\ndescribe('npm install', () =\u003e {\n  describe('install package', () =\u003e {\n    it('should install package to node_modules')\n    it('should install specific version')\n    it('should install scoped package')\n    it('should update package.json with -S')\n    it('should install as devDep with -D')\n  })\n  \n  describe('install from package.json', () =\u003e {\n    it('should install all dependencies')\n    it('should install devDependencies')\n    it('should skip devDeps with --production')\n    it('should respect lockfile')\n  })\n  \n  describe('node_modules structure', () =\u003e {\n    it('should create flat node_modules')\n    it('should create .bin symlinks')\n    it('should handle nested dependencies')\n  })\n})\n```","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T05:15:53.023728-06:00","created_by":"nathanclevenger","updated_at":"2026-01-10T05:15:53.023728-06:00","labels":["layer:runner","tdd:red"]}
{"id":"npmx-8p1","title":"REFACTOR: bashx integration \u0026 ESM optimization","description":"Integrate with bashx.do and optimize for ESM packages.\n\n## bashx Integration\n```typescript\n// In bashx TieredExecutor\ncase 'npm':\n  return this.npmx.handleNpm(args)\ncase 'npx':\n  return this.npmx.handleNpx(args)\n```\n\n## ESM Optimization\n- Detect ESM-only packages\n- Use esm.sh/skypack for simple imports\n- Skip extraction for pure ESM packages\n- Generate import maps\n\n## Caching Strategy\n- fsx handles storage tiers automatically\n- Add in-memory metadata cache\n- Cache resolved dependency trees","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T05:15:55.149127-06:00","created_by":"nathanclevenger","updated_at":"2026-01-10T05:15:55.149127-06:00","labels":["integration","tdd:refactor"]}
{"id":"npmx-aen","title":"GREEN: Implement RegistryClient","description":"Implement registry client to pass RED tests.\n\n## Implementation\n```typescript\nclass RegistryClient {\n  constructor(private fsx: FsxClient, private registry = 'https://registry.npmjs.org')\n  \n  async getPackage(name: string): Promise\u003cPackageMetadata\u003e {\n    const url = `${this.registry}/${encodeURIComponent(name)}`\n    const res = await fetch(url)\n    return res.json()\n  }\n  \n  async install(name: string, version: string, dest: string): Promise\u003cvoid\u003e {\n    const meta = await this.getVersion(name, version)\n    const tarball = await fetch(meta.dist.tarball)\n    await this.extractTarball(tarball.body, dest)\n  }\n  \n  private async extractTarball(stream: ReadableStream, dest: string): Promise\u003cvoid\u003e {\n    // gunzip → untar → write each file to fsx\n  }\n}\n```\n\n## Files\n- `src/registry/client.ts`\n- `src/registry/types.ts`","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T05:15:50.778367-06:00","created_by":"nathanclevenger","updated_at":"2026-01-10T05:15:50.778367-06:00","labels":["layer:registry","tdd:green"],"dependencies":[{"issue_id":"npmx-aen","depends_on_id":"npmx-eqm","type":"blocks","created_at":"2026-01-10T05:16:12.455691-06:00","created_by":"nathanclevenger"}]}
{"id":"npmx-buo","title":"RED: npx execution tests","description":"Write failing tests for npx command.\n\n## Test Cases\n```typescript\ndescribe('npx', () =\u003e {\n  describe('local execution', () =\u003e {\n    it('should run from node_modules/.bin')\n    it('should prefer local over remote')\n  })\n  \n  describe('remote execution', () =\u003e {\n    it('should download and run package')\n    it('should run specific version')\n    it('should cleanup after execution')\n    it('should cache for repeated runs')\n  })\n  \n  describe('options', () =\u003e {\n    it('should support -p for additional packages')\n    it('should support -c for command string')\n    it('should support --no-install')\n    it('should support --yes for auto-confirm')\n  })\n})\n```","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T05:15:54.218949-06:00","created_by":"nathanclevenger","updated_at":"2026-01-10T05:15:54.218949-06:00","labels":["layer:runner","tdd:red"]}
{"id":"npmx-c34","title":"GREEN: Implement DependencyResolver","description":"Implement dependency resolver to pass RED tests.\n\n## Implementation\n```typescript\nclass DependencyResolver {\n  constructor(private registry: RegistryClient)\n  \n  async buildTree(packageJson: PackageJson): Promise\u003cDependencyTree\u003e {\n    const root: DependencyNode = { name: 'root', version: '0.0.0', dependencies: [] }\n    \n    for (const [name, range] of Object.entries(packageJson.dependencies || {})) {\n      const node = await this.resolvePackage(name, range, new Set())\n      root.dependencies.push(node)\n    }\n    \n    return this.deduplicate(root)\n  }\n  \n  private async resolvePackage(name: string, range: string, seen: Set\u003cstring\u003e): Promise\u003cDependencyNode\u003e {\n    // Fetch metadata, resolve version, recurse on dependencies\n  }\n  \n  private deduplicate(tree: DependencyNode): DependencyTree {\n    // Hoist compatible versions to reduce duplication\n  }\n}\n```\n\n## Files\n- `src/resolver/tree.ts`\n- `src/resolver/lockfile.ts`","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T05:15:52.367067-06:00","created_by":"nathanclevenger","updated_at":"2026-01-10T05:15:52.367067-06:00","labels":["layer:resolver","tdd:green"],"dependencies":[{"issue_id":"npmx-c34","depends_on_id":"npmx-zfn","type":"blocks","created_at":"2026-01-10T05:16:12.854159-06:00","created_by":"nathanclevenger"},{"issue_id":"npmx-c34","depends_on_id":"npmx-s9l","type":"blocks","created_at":"2026-01-10T05:16:13.255414-06:00","created_by":"nathanclevenger"}]}
{"id":"npmx-eqm","title":"RED: Registry client tests (metadata, tarball, extract)","description":"Write failing tests for npm registry client.\n\n## Test Cases\n```typescript\ndescribe('RegistryClient', () =\u003e {\n  describe('getPackage', () =\u003e {\n    it('should fetch package metadata from registry')\n    it('should handle scoped packages (@org/pkg)')\n    it('should handle 404 for unknown package')\n    it('should parse versions list')\n    it('should extract dist-tags (latest, next)')\n  })\n  \n  describe('getVersion', () =\u003e {\n    it('should fetch specific version metadata')\n    it('should return tarball URL')\n    it('should return dependencies')\n    it('should return peerDependencies')\n  })\n  \n  describe('install', () =\u003e {\n    it('should download tarball')\n    it('should extract to destination via fsx')\n    it('should handle gzipped tarball')\n    it('should strip package/ prefix from paths')\n    it('should verify integrity (shasum)')\n  })\n})\n```\n\nImport from './registry/client.js' (doesn't exist yet).","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T05:15:50.333682-06:00","created_by":"nathanclevenger","updated_at":"2026-01-10T05:15:50.333682-06:00","labels":["layer:registry","tdd:red"]}
{"id":"npmx-m7k","title":"RED: npm run script tests","description":"Write failing tests for npm run command.\n\n## Test Cases\n```typescript\ndescribe('npm run', () =\u003e {\n  describe('script execution', () =\u003e {\n    it('should run script from package.json')\n    it('should pass arguments after --')\n    it('should set npm_lifecycle_event')\n    it('should set npm_package_* variables')\n    it('should add node_modules/.bin to PATH')\n  })\n  \n  describe('pre/post hooks', () =\u003e {\n    it('should run preX before X')\n    it('should run postX after X')\n    it('should skip hooks if script fails')\n  })\n  \n  describe('special scripts', () =\u003e {\n    it('should run start as \"node server.js\" if missing')\n    it('should run test command')\n    it('should list scripts with npm run')\n  })\n})\n```","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T05:15:53.69645-06:00","created_by":"nathanclevenger","updated_at":"2026-01-10T05:15:53.69645-06:00","labels":["layer:runner","tdd:red"]}
{"id":"npmx-mqe","title":"Runner Layer - Script \u0026 Package Execution","description":"Execute npm scripts and npx packages via bashx.do.\n\n## Responsibilities\n1. **Script Parsing**: Parse package.json scripts section\n2. **Environment Setup**: Set PATH, npm_* variables\n3. **Binary Resolution**: Find executables in node_modules/.bin\n4. **npx Execution**: Download, run, cleanup temporary packages\n\n## API\n```typescript\ninterface ScriptRunner {\n  // Run npm script\n  run(script: string, args?: string[]): Promise\u003cRunResult\u003e\n  \n  // Execute npx package\n  exec(package: string, args?: string[]): Promise\u003cRunResult\u003e\n  \n  // Find binary in node_modules\n  findBin(name: string): Promise\u003cstring | null\u003e\n}\n```\n\n## Environment Variables\n- `PATH` prepended with `node_modules/.bin`\n- `npm_package_name`, `npm_package_version`\n- `npm_lifecycle_event` (script name)\n- `npm_config_*` for npm config values","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-10T05:15:02.636293-06:00","created_by":"nathanclevenger","updated_at":"2026-01-10T05:15:02.636293-06:00","dependencies":[{"issue_id":"npmx-mqe","depends_on_id":"npmx-mz2","type":"parent-child","created_at":"2026-01-10T05:16:12.044204-06:00","created_by":"nathanclevenger"}]}
{"id":"npmx-mz2","title":"npmx.do - NPM/NPX for Edge Runtimes","description":"Edge-native package management - run `npm install` and `npx` without Node.js.\n\n## Architecture\n\n```\n┌─────────────────────────────────────────────────────────────┐\n│                        npmx.do                              │\n│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │\n│  │  Registry   │  │  Resolver   │  │      Runner         │ │\n│  │  - fetch    │  │  - semver   │  │  - npm run          │ │\n│  │  - metadata │  │  - tree     │  │  - npx exec         │ │\n│  │  - extract  │  │  - lockfile │  │  - scripts          │ │\n│  └──────┬──────┘  └──────┬──────┘  └──────────┬──────────┘ │\n└─────────┼────────────────┼────────────────────┼────────────┘\n          ▼                ▼                    ▼\n┌─────────────────────────────────────────────────────────────┐\n│                        fsx.do                               │\n│         (handles all storage - SQLite hot, R2 cold)         │\n└─────────────────────────────────────────────────────────────┘\n```\n\n## Key Insight\nnpmx just uses fsx.do as a filesystem - fsx handles tiered storage (SQLite/R2) automatically. No R2 logic in npmx.\n\n## Commands to Support\n- `npm install \u003cpackage\u003e`\n- `npm install` (from package.json)\n- `npm run \u003cscript\u003e`\n- `npx \u003cpackage\u003e` \n- `npx \u003cpackage\u003e@\u003cversion\u003e`\n\n## Success Criteria\n- [ ] Install package from npm registry\n- [ ] Resolve semver versions correctly\n- [ ] Build dependency tree with deduplication\n- [ ] Run package.json scripts\n- [ ] Execute npx packages (download + run + cleanup)\n- [ ] Integration with bashx.do","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-10T05:15:00.810727-06:00","created_by":"nathanclevenger","updated_at":"2026-01-10T05:15:00.810727-06:00"}
{"id":"npmx-s0f","title":"GREEN: Implement npm/npx commands","description":"Implement npm/npx command handlers.\n\n## Implementation\n```typescript\nclass NpmCommands {\n  constructor(\n    private registry: RegistryClient,\n    private resolver: DependencyResolver,\n    private fsx: FsxClient,\n    private bashx: BashxClient\n  )\n  \n  async install(args: string[]): Promise\u003cvoid\u003e {\n    if (args.length === 0) {\n      return this.installFromPackageJson()\n    }\n    return this.installPackage(args[0])\n  }\n  \n  async run(script: string, args: string[]): Promise\u003cRunResult\u003e {\n    const pkg = await this.fsx.readJson('package.json')\n    const cmd = pkg.scripts?.[script]\n    return this.bashx.exec(cmd, { env: this.buildEnv(pkg) })\n  }\n}\n\nclass NpxCommand {\n  async exec(pkg: string, args: string[]): Promise\u003cRunResult\u003e {\n    // Check local, download if needed, run, cleanup\n  }\n}\n```\n\n## Files\n- `src/commands/install.ts`\n- `src/commands/run.ts`\n- `src/commands/npx.ts`","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T05:15:54.688915-06:00","created_by":"nathanclevenger","updated_at":"2026-01-10T05:15:54.688915-06:00","labels":["layer:runner","tdd:green"],"dependencies":[{"issue_id":"npmx-s0f","depends_on_id":"npmx-8cd","type":"blocks","created_at":"2026-01-10T05:16:13.662625-06:00","created_by":"nathanclevenger"},{"issue_id":"npmx-s0f","depends_on_id":"npmx-m7k","type":"blocks","created_at":"2026-01-10T05:16:14.067071-06:00","created_by":"nathanclevenger"},{"issue_id":"npmx-s0f","depends_on_id":"npmx-buo","type":"blocks","created_at":"2026-01-10T05:16:14.481825-06:00","created_by":"nathanclevenger"}]}
{"id":"npmx-s9l","title":"RED: Dependency tree builder tests","description":"Write failing tests for dependency tree resolution.\n\n## Test Cases\n```typescript\ndescribe('DependencyResolver', () =\u003e {\n  describe('buildTree', () =\u003e {\n    it('should resolve direct dependencies')\n    it('should resolve transitive dependencies')\n    it('should deduplicate compatible versions')\n    it('should handle circular dependencies')\n    it('should handle peer dependencies')\n    it('should handle optional dependencies')\n  })\n  \n  describe('lockfile', () =\u003e {\n    it('should read package-lock.json')\n    it('should use locked versions when available')\n    it('should write new lockfile')\n    it('should detect lockfile changes')\n  })\n  \n  describe('install order', () =\u003e {\n    it('should return flat list for installation')\n    it('should respect hoisting')\n  })\n})\n```","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T05:15:51.703261-06:00","created_by":"nathanclevenger","updated_at":"2026-01-10T05:15:51.703261-06:00","labels":["layer:resolver","tdd:red"]}
{"id":"npmx-wn8","title":"Resolver Layer - Dependency Resolution","description":"Resolve dependencies using semver and build installation tree.\n\n## Responsibilities\n1. **Semver Resolution**: Match version ranges to available versions\n2. **Dependency Tree**: Build tree from package.json dependencies\n3. **Deduplication**: Hoist compatible versions to reduce duplication\n4. **Lock Files**: Read/write package-lock.json for reproducible builds\n5. **Peer Dependencies**: Handle peer dep requirements\n\n## API\n```typescript\ninterface DependencyResolver {\n  // Resolve single package version\n  resolve(name: string, range: string): Promise\u003cstring\u003e\n  \n  // Build full dependency tree\n  buildTree(packageJson: PackageJson): Promise\u003cDependencyTree\u003e\n  \n  // Read lock file\n  readLockfile(path: string): Promise\u003cLockfile\u003e\n  \n  // Write lock file\n  writeLockfile(path: string, tree: DependencyTree): Promise\u003cvoid\u003e\n}\n```\n\n## Semver Ranges\n- `^1.2.3` → \u003e=1.2.3 \u003c2.0.0\n- `~1.2.3` → \u003e=1.2.3 \u003c1.3.0\n- `1.2.x` → \u003e=1.2.0 \u003c1.3.0\n- `*` → any version","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-10T05:15:01.995734-06:00","created_by":"nathanclevenger","updated_at":"2026-01-10T05:15:01.995734-06:00","dependencies":[{"issue_id":"npmx-wn8","depends_on_id":"npmx-mz2","type":"parent-child","created_at":"2026-01-10T05:16:11.524257-06:00","created_by":"nathanclevenger"}]}
{"id":"npmx-xnc","title":"Registry Layer - npm Registry Client","description":"Fetch packages from npm registry and extract to fsx.do.\n\n## Responsibilities\n1. **Metadata Fetching**: GET package info from registry.npmjs.org\n2. **Tarball Download**: Fetch .tgz package files\n3. **Extraction**: Untar/ungzip to fsx.do filesystem\n4. **Caching**: Let fsx handle storage (auto-tiers to R2 for large files)\n\n## API\n```typescript\ninterface RegistryClient {\n  // Get package metadata\n  getPackage(name: string): Promise\u003cPackageMetadata\u003e\n  \n  // Get specific version\n  getVersion(name: string, version: string): Promise\u003cVersionMetadata\u003e\n  \n  // Download and extract to fsx\n  install(name: string, version: string, dest: string): Promise\u003cvoid\u003e\n}\n```\n\n## Registry API\n- `GET https://registry.npmjs.org/\u003cpackage\u003e` → full metadata\n- `GET https://registry.npmjs.org/\u003cpackage\u003e/\u003cversion\u003e` → version metadata\n- Tarball URL in `dist.tarball` field","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-10T05:15:01.286508-06:00","created_by":"nathanclevenger","updated_at":"2026-01-10T05:15:01.286508-06:00","dependencies":[{"issue_id":"npmx-xnc","depends_on_id":"npmx-mz2","type":"parent-child","created_at":"2026-01-10T05:16:10.955381-06:00","created_by":"nathanclevenger"}]}
{"id":"npmx-zfn","title":"RED: Semver resolution tests","description":"Write failing tests for semver version resolution.\n\n## Test Cases\n```typescript\ndescribe('semver', () =\u003e {\n  describe('satisfies', () =\u003e {\n    it('should match exact version \"1.2.3\"')\n    it('should match caret range \"^1.2.3\"')\n    it('should match tilde range \"~1.2.3\"')\n    it('should match x-range \"1.2.x\"')\n    it('should match star \"*\"')\n    it('should match \u003e=, \u003c=, \u003e, \u003c ranges')\n    it('should match OR ranges \"1.x || 2.x\"')\n  })\n  \n  describe('maxSatisfying', () =\u003e {\n    it('should find highest matching version')\n    it('should return null if no match')\n    it('should handle prerelease versions')\n  })\n  \n  describe('compare', () =\u003e {\n    it('should sort versions correctly')\n    it('should handle prerelease ordering')\n  })\n})\n```\n\nCan use semver package or implement subset.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T05:15:51.236988-06:00","created_by":"nathanclevenger","updated_at":"2026-01-10T05:15:51.236988-06:00","labels":["layer:resolver","tdd:red"]}
